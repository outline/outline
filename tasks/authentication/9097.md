# Bug: Authentication migration: Unable to match existing users after switching from OIDC to GitLab authentication

## Details
- **Issue ID**: #9097
- **Status**: Open
- **Priority**: Low
- **Category**: authentication
- **Created**: 4/29/2025
- **Updated**: 4/30/2025
- **Author**: chen-coco


## Labels
- bug
- self-hosted

## Description
### Is there an existing issue for this?

- [x] I have searched the existing issues

### This is not related to configuring Outline

- [x] The issue is not related to self-hosting config

### Current Behavior

I recently switched the authentication method in Outline from OIDC to GitLab integration. However, existing users and newly logged-in GitLab users cannot be matched correctly, even though their email addresses and user IDs are identical.

Instead of recognizing them as the same users, Outline creates new accounts or links them incorrectly.

It seems that the authentication provider information is causing a mismatch even with identical emails and IDs.

### Expected Behavior

When a user logs in through GitLab and their email matches an existing user (previously authenticated via OIDC), Outline should associate the login with the existing user account, not create a new one.

### Steps To Reproduce

1. Set up Outline with OIDC authentication and create user accounts.
2. Switch authentication provider to GitLab.
3. Try logging in with the same email via GitLab.
4. Notice that a new user account is created instead of mapping to the existing one.

### Environment

```markdown
- Outline:0.83.0
- Browser:edge
```

### Anything else?

It appears Outline matches users based on authentication provider ID and name instead of email address alone. It would be helpful to support matching users based on email during authentication provider migrations.

## Original Issue
https://github.com/outline/outline/issues/9097

## Notes
- This bug was imported from the original Outline repository
- Original issue: https://github.com/outline/outline/issues/9097
- Please verify if this issue is still relevant in this fork

## Tasks
- [ ] Investigate if this bug exists in current codebase
- [ ] Reproduce the issue if possible
- [ ] Determine root cause
- [ ] Implement fix
- [ ] Add tests to prevent regression
- [ ] Update documentation if needed

---
*Imported on 2025-07-27T06:43:33.910Z*
