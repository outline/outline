# Bug: API document.update stops updating document after doc was edited by user

## Details
- **Issue ID**: #7868
- **Status**: Open
- **Priority**: Low
- **Category**: api-integration
- **Created**: 10/30/2024
- **Updated**: 6/30/2025
- **Author**: bezzil85


## Labels
- bug

## Description
**Update** : After several tests and searches, found out that in base document gets changed, but of some user has it opened in tab in view mode, changed not going to apply for front, till that tab is opened, so autoupdating can be sabotaged that way

**To Reproduce**
Steps to reproduce the behavior:
1. Create document
2. Send POST request to /api/documents.update with body for example, 
{"append": true, "id": "<doc-id>", "text": "some text"}
3. Check that document has been changed
4. Edit document by any other user, except user who got api key for previous request
5. Repeat step 2
6. Check document, history record that doc was changed appears, but change will not be applied

**Expected behavior**
Appended text should appear in document

**Screenshots**
Outline log:
<img width="1472" alt="image" src="https://github.com/user-attachments/assets/b1498b32-0af2-40fa-ad85-163905db797e">
No changes in doc :
<img width="863" alt="image" src="https://github.com/user-attachments/assets/58df5f28-2afb-48df-a7a4-2ca2ef3cc600">
Post request:
<img width="1060" alt="image" src="https://github.com/user-attachments/assets/b637a995-d9c1-4780-b53d-010f87375bdb">

<details><summary>Log</summary>
<p>
{"label":"http","level":"info","message":"  <-- POST /api/documents.update"}
{"label":"http","level":"info","message":"  --> POST /api/documents.update 200 306ms 1.79kb"}
{"attempt":0,"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:04:25.154Z","data":{"title":"Copy of Test Document"},"documentId":"48822899-a803-4bf4-81e3-b8a1b8d00957","id":"23a87a1f-4c6a-41ca-8a5f-3b28e107f8ae","ip":"51.250.78.151","modelId":null,"name":"documents.update","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"Processing documents.update"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:04:25.154Z","data":{"title":"Copy of Test Document"},"documentId":"48822899-a803-4bf4-81e3-b8a1b8d00957","id":"23a87a1f-4c6a-41ca-8a5f-3b28e107f8ae","ip":"51.250.78.151","modelId":null,"name":"documents.update","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"BacklinksProcessor running documents.update"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:04:25.154Z","data":{"title":"Copy of Test Document"},"documentId":"48822899-a803-4bf4-81e3-b8a1b8d00957","id":"23a87a1f-4c6a-41ca-8a5f-3b28e107f8ae","ip":"51.250.78.151","modelId":null,"name":"documents.update","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"DebounceProcessor running documents.update"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:04:25.154Z","data":{"title":"Copy of Test Document"},"documentId":"48822899-a803-4bf4-81e3-b8a1b8d00957","id":"23a87a1f-4c6a-41ca-8a5f-3b28e107f8ae","ip":"51.250.78.151","modelId":null,"name":"documents.update","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"RevisionsProcessor running documents.update"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:04:25.154Z","data":{"title":"Copy of Test Document"},"documentId":"48822899-a803-4bf4-81e3-b8a1b8d00957","id":"23a87a1f-4c6a-41ca-8a5f-3b28e107f8ae","ip":"51.250.78.151","modelId":null,"name":"documents.update","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"WebhookProcessor running documents.update"}
{"attempt":0,"event":{"actorId":"f5a3396b-97de-4845-ae28-4b32ccfb2c88","collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T12:59:42.242Z","data":{"done":false,"multiplayer":true,"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"9f923514-07d3-45c7-ba84-d8410f36a52e","name":"documents.update.delayed","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58"},"label":"worker","level":"info","message":"Processing documents.update.delayed"}
{"event":{"actorId":"f5a3396b-97de-4845-ae28-4b32ccfb2c88","collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T12:59:42.242Z","data":{"done":false,"multiplayer":true,"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"9f923514-07d3-45c7-ba84-d8410f36a52e","name":"documents.update.delayed","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58"},"label":"worker","level":"info","message":"DebounceProcessor running documents.update.delayed"}
{"event":{"actorId":"f5a3396b-97de-4845-ae28-4b32ccfb2c88","collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T12:59:42.242Z","data":{"done":false,"multiplayer":true,"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"9f923514-07d3-45c7-ba84-d8410f36a52e","name":"documents.update.delayed","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58"},"label":"worker","level":"info","message":"WebhookProcessor running documents.update.delayed"}
{"label":"http","level":"info","message":"  <-- GET /_health"}
{"label":"http","level":"info","message":"  --> GET /_health 200 25ms 2b"}
{"attempt":0,"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:00:40.444Z","data":{"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"0660b9d9-9c3b-4c53-854b-a63a6470ffff","ip":"51.250.78.151","modelId":null,"name":"documents.update.delayed","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"Processing documents.update.delayed"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:00:40.444Z","data":{"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"0660b9d9-9c3b-4c53-854b-a63a6470ffff","ip":"51.250.78.151","modelId":null,"name":"documents.update.delayed","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"DebounceProcessor running documents.update.delayed"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:00:40.444Z","data":{"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"0660b9d9-9c3b-4c53-854b-a63a6470ffff","ip":"51.250.78.151","modelId":null,"name":"documents.update.delayed","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"WebhookProcessor running documents.update.delayed"}
{"attempt":0,"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:00:40.444Z","data":{"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"0660b9d9-9c3b-4c53-854b-a63a6470ffff","ip":"51.250.78.151","modelId":null,"name":"documents.update.debounced","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"Processing documents.update.debounced"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:00:40.444Z","data":{"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"0660b9d9-9c3b-4c53-854b-a63a6470ffff","ip":"51.250.78.151","modelId":null,"name":"documents.update.debounced","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"RevisionsProcessor running documents.update.debounced"}
{"event":{"actorId":"b69e473d-953d-4c29-9508-280785c207b7","changes":null,"collectionId":"550081e7-1d9a-4b1d-83ae-e563a243f2a0","createdAt":"2024-10-30T13:00:40.444Z","data":{"title":"Test Document"},"documentId":"9515dc72-ca33-44c6-8122-86c2ccb0aefc","id":"0660b9d9-9c3b-4c53-854b-a63a6470ffff","ip":"51.250.78.151","modelId":null,"name":"documents.update.debounced","teamId":"f963450c-6db7-4722-b4a2-5a8a22996d58","userId":null},"label":"worker","level":"info","message":"WebhookProcessor running documents.update.debounced"}
{"label":"multiplayer","level":"info","message":"Closed connection to \"document.48822899-a803-4bf4-81e3-b8a1b8d00957\"","userId":"f5a3396b-97de-4845-ae28-4b32ccfb2c88"}
</p>
</details> 


**Outline (please complete the following information):**
- Install:self hosted
- Version: 0.79

**Desktop (please complete the following information):**
 - OS: Ubuntu 24.04
 - Outline runs in docker




## Original Issue
https://github.com/outline/outline/issues/7868

## Notes
- This bug was imported from the original Outline repository
- Original issue: https://github.com/outline/outline/issues/7868
- Please verify if this issue is still relevant in this fork

## Tasks
- [ ] Investigate if this bug exists in current codebase
- [ ] Reproduce the issue if possible
- [ ] Determine root cause
- [ ] Implement fix
- [ ] Add tests to prevent regression
- [ ] Update documentation if needed

---
*Imported on 2025-07-27T06:43:33.907Z*
